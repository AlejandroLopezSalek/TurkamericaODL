---
layout: base.njk
scripts:
- lesson-editor.js
- admin-contributions.js
---

<div class="max-w-7xl mx-auto px-4 py-8" id="admin-dashboard-page">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-slate-800 dark:text-white">Panel de Administración</h1>
        <p class="text-slate-600 dark:text-slate-400 mt-2">Gestiona las contribuciones de la comunidad</p>
    </div>

    <!-- Stats Overview -->
    <div
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8 lg:mb-12 overflow-x-auto sm:overflow-visible snap-x snap-mandatory sm:snap-none pb-4 sm:pb-0 scrollbar-none">

        <!-- Pendientes -->
        <div
            class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 shadow-sm flex items-center gap-5 snap-center min-w-[260px] sm:min-w-0">
            <div
                class="w-14 h-14 rounded-xl flex items-center justify-center text-xl bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 shrink-0">
                <i class="fas fa-clock"></i>
            </div>
            <div>
                <h3 id="statPending" class="text-2xl font-bold text-slate-800 dark:text-white">0</h3>
                <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Pendientes</p>
            </div>
        </div>

        <!-- Aprobadas -->
        <div
            class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 shadow-sm flex items-center gap-5 snap-center min-w-[260px] sm:min-w-0">
            <div
                class="w-14 h-14 rounded-xl flex items-center justify-center text-xl bg-emerald-50 text-emerald-600 dark:bg-emerald-900/20 dark:text-emerald-400 shrink-0">
                <i class="fas fa-check-circle"></i>
            </div>
            <div>
                <h3 id="statApproved" class="text-2xl font-bold text-slate-800 dark:text-white">0</h3>
                <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Aprobadas</p>
            </div>
        </div>

        <!-- Rechazadas -->
        <div
            class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 shadow-sm flex items-center gap-5 snap-center min-w-[260px] sm:min-w-0">
            <div
                class="w-14 h-14 rounded-xl flex items-center justify-center text-xl bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 shrink-0">
                <i class="fas fa-times-circle"></i>
            </div>
            <div>
                <h3 id="statRejected" class="text-2xl font-bold text-slate-800 dark:text-white">0</h3>
                <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Rechazadas</p>
            </div>
        </div>

        <!-- Total -->
        <div
            class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 shadow-sm flex items-center gap-5 snap-center min-w-[260px] sm:min-w-0">
            <div
                class="w-14 h-14 rounded-xl flex items-center justify-center text-xl bg-slate-50 text-slate-600 dark:bg-slate-700/50 dark:text-slate-400 shrink-0">
                <i class="fas fa-list"></i>
            </div>
            <div>
                <h3 id="statTotal" class="text-2xl font-bold text-slate-800 dark:text-white">0</h3>
                <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Total</p>
            </div>
        </div>
    </div>

    <!-- Filter Tabs -->
    <div
        class="flex flex-wrap items-center gap-3 mb-8 border-b border-slate-200 dark:border-slate-700 pb-4 overflow-x-auto scrollbar-none">
        <button
            class="filter-tab active px-4 py-2 rounded-lg font-medium text-sm transition-all whitespace-nowrap flex items-center gap-2 outline-none focus:ring-2 focus:ring-indigo-500/50 bg-indigo-600 text-white shadow-md shadow-indigo-500/20"
            data-filter="all">
            Todas <span class="bg-white/20 text-white px-2 py-0.5 rounded-full text-xs font-bold" id="badgeAll">0</span>
        </button>
        <button
            class="filter-tab px-4 py-2 rounded-lg font-medium text-sm transition-all whitespace-nowrap flex items-center gap-2 outline-none focus:ring-2 focus:ring-indigo-500/50 text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800"
            data-filter="lesson_edit">
            Lecciones <span
                class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-2 py-0.5 rounded-full text-xs font-bold"
                id="badgeLessons">0</span>
        </button>
        <button
            class="filter-tab px-4 py-2 rounded-lg font-medium text-sm transition-all whitespace-nowrap flex items-center gap-2 outline-none focus:ring-2 focus:ring-indigo-500/50 text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800"
            data-filter="book_upload">
            Libros <span
                class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-2 py-0.5 rounded-full text-xs font-bold"
                id="badgeBooks">0</span>
        </button>
    </div>

    <!-- Requests List -->
    <div class="mb-12">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-slate-800 dark:text-white flex items-center gap-3">
                <i class="fas fa-inbox text-indigo-500"></i> Solicitudes Pendientes
            </h2>
            <button
                class="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-2"
                onclick="loadRequests()">
                <i class="fas fa-sync-alt"></i> Actualizar
            </button>
        </div>

        <div id="requestsList" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>
</div>

<!-- Request Detail Modal -->
<div class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300"
    id="requestModal">
    <div
        class="modal-content bg-white dark:bg-slate-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl transform scale-95 transition-all duration-300 border border-slate-200 dark:border-slate-700">
        <div
            class="modal-header flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 sticky top-0 z-10 backdrop-blur-md">
            <h2 id="modalTitle" class="text-xl font-bold text-slate-800 dark:text-white">Detalles de la Solicitud</h2>
            <button
                class="close-modal w-10 h-10 rounded-full flex items-center justify-center text-slate-500 hover:bg-red-50 hover:text-red-500 dark:text-slate-400 dark:hover:bg-red-900/20 dark:hover:text-red-400 transition-colors"
                onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body p-6 md:p-8 space-y-8" id="modalBody">
            <!-- Will be populated by JavaScript -->
        </div>

        <div
            class="modal-actions flex flex-col sm:flex-row items-center justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 sticky bottom-0 z-10">
            <button
                class="w-full sm:w-auto px-6 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-semibold shadow-lg shadow-emerald-500/20 flex items-center justify-center gap-2 transition-all hover:-translate-y-0.5"
                id="approveBtn">
                <i class="fas fa-check"></i> Aprobar
            </button>
            <button
                class="w-full sm:w-auto px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-xl font-semibold shadow-lg shadow-red-500/20 flex items-center justify-center gap-2 transition-all hover:-translate-y-0.5"
                id="rejectBtn">
                <i class="fas fa-times"></i> Rechazar
            </button>
            <button
                class="w-full sm:w-auto px-6 py-2.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-all"
                onclick="closeModal()">
                Cancelar
            </button>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300"
    id="confirmModal">
    <div
        class="modal-content bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl transform scale-95 transition-all duration-300 border border-slate-200 dark:border-slate-700 p-0 overflow-hidden">
        <div
            class="modal-header flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
            <h2 id="confirmTitle" class="text-xl font-bold text-slate-800 dark:text-white">Confirmar Acción</h2>
        </div>

        <div class="modal-body p-6">
            <p id="confirmMessage" class="text-slate-600 dark:text-slate-300 mb-4 text-lg"></p>
            <div class="form-group" id="reasonGroup" style="display:none;">
                <label for="rejectionReason"
                    class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Razón del rechazo
                    (opcional):</label>
                <textarea id="rejectionReason" rows="3"
                    class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
                    placeholder="Explica por qué se rechaza esta solicitud..."></textarea>
            </div>
        </div>

        <div
            class="modal-actions flex flex-col sm:flex-row items-center justify-end gap-3 p-6 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700">
            <button
                class="w-full sm:w-auto px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-semibold shadow-lg shadow-indigo-500/20 flex items-center justify-center gap-2 transition-all hover:-translate-y-0.5"
                id="confirmBtn">Confirmar</button>
            <button
                class="w-full sm:w-auto px-6 py-2.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-all"
                onclick="closeConfirmModal()">Cancelar</button>
        </div>
    </div>
</div>